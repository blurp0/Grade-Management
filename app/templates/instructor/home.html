<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Instructor Home Â· Grade Management{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor.css') }}" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js included only once -->
</head>
<body>

  <nav>
    <a href="{{ url_for('main.instructor') }}" class="{% if request.endpoint == 'main.home' %}active{% endif %}">Home</a>
    <a href="{{ url_for('main.record_assessments') }}" class="{% if request.endpoint == 'main.home' %}active{% endif %}">Grade</a>
    <a href="{{ url_for('main.instructor_students') }}" class="{% if active == 'students' %}active{% endif %}">Students</a>
    <a href="{{ url_for('main.instructor_profile') }}" class="{% if active == 'profile' %}active{% endif %}">Profile</a>
    <a href="{{ url_for('main.logout') }}" class="logout-link">Logout</a>
  </nav>

  <main>
    {% block content %}
<div class="container mt-4">
  <h1 class="mb-4">Instructor Dashboard</h1>

  <div class="row g-4 justify-content-center">
    <!-- Total Students Card -->
    <div class="col-md-6">
      <div class="card text-white bg-primary shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Total Students</h5>
          <p class="display-6">{{ total_students }}</p>
        </div>
      </div>
    </div>

    <!-- Subjects Handled Card -->
    <div class="col-md-6">
      <div class="card text-white bg-success shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Subjects Handled</h5>
          <p class="display-6">{{ num_subjects }}</p>
        </div>
      </div>
    </div>

    <!-- Top Student Card -->
    <div class="col-md-6">
      <div class="card shadow-sm" style="min-height: 300px;">
        <div class="card-body text-center d-flex flex-column justify-content-center">
          <h5 class="card-title">Top Student</h5>
          {% if top_student_name %}
            <p class="card-text fs-5">ðŸŽ“ <strong>{{ top_student_name }}</strong></p>
          {% else %}
            <p class="card-text">No grades available to determine the top student.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Pie Chart -->
    <!-- Pie Chart -->
<div class="col-md-6 d-flex justify-content-center align-items-center">
  <div style="width: 50%; max-width: 300px; aspect-ratio: 1 / 1;">
    <canvas id="gradePieChart" style="width: 100%; height: 100%;"></canvas>
  </div>
</div>
{% endblock %}



  </main>

  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      <div class="modal fade" id="flashModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-sm modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-body text-center">
              {% for category, msg in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} mb-0" role="alert">
                  {{ msg }}
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endwith %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('gradePieChart');
    if (ctx) {
      {% set passed = passed_count if passed_count is defined else 0 %}
      {% set failed = failed_count if failed_count is defined else 0 %}

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Passed', 'Failed'],
          datasets: [{
            data: [{{ passed }}, {{ failed }}],
            backgroundColor: ['#28a745', '#dc3545']
          }]
        },
        options: {
          plugins: {
            title: {
              display: true,
              text: 'Passed vs Failed Students',
              font: { size: 18 }
            },
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
  });
</script>

</body>
</html>
